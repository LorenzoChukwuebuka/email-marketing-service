# Stage 1: Build the React frontend
FROM node:18 as frontend-builder

WORKDIR /app/frontend
COPY . ./
RUN npm install
RUN npm run build:staging

# Stage 2: Serve the frontend with a lightweight server
FROM node:18-alpine

WORKDIR /app
RUN npm install -g serve

# Copy the frontend build from the builder stage
COPY --from=frontend-builder /app/frontend/dist /app/dist

# Expose port
EXPOSE 6000

# Start serve
CMD ["serve", "-s", "dist", "-l", "6000"]